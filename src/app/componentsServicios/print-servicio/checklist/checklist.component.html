<div id="bodyCheckList" class="checklistpopup">
    <div class="modal-header">
        <div>
            <h6 class="modal-title font-weight-bold">CHECKLIST</h6>
            <h5>Seleccioná un elemento para ver su descripción</h5>
        </div>
        <mat-icon style="font-size: 1.2rem; cursor: pointer;" [mat-dialog-close]="true">close</mat-icon>
    </div>

    <!-- Cuerpo del checklist -->
    <div class="modal-body">

        <!-- Progress bar -->
        <span style="display: block; padding-bottom: 0.3rem;">
            <mat-progress-bar mode="determinate" [value]="avance"></mat-progress-bar>
        </span>

        <!-- Lista de items del checklist -->
        <div id="checkBox" class="list-group">

            <cdk-accordion>

                <cdk-accordion-item #accordionItem="cdkAccordionItem" role="button" tabindex="0"
                    *ngFor="let item of dataSourceItems; let index = index" [attr.id]="'accordion-header-' + index"
                    [attr.aria-expanded]="accordionItem.expanded" [attr.aria-controls]="'accordion-body-' + index">
                    
                    <div (click)="accordionItem.toggle()">
                        <!-- Rotulo del item del checklist -->
                        <p
                            class="list-group-item list-group-item-action checkboxContainer rowChecklist rowDetail editable">
                            <span>
                                <mat-checkbox [disabled]="item.completo && item.finReal" [checked]="item.completo" (change)="updateAvance(item); getChange(index, item)"
                                    (click)="$event.stopPropagation()">
                                </mat-checkbox>
                                <span>
                                    {{item.nombreItem}} &nbsp;
                                    <span style="font-style: oblique; color: #f44336;">
                                        {{item.notificado ? '"Se considera notificado"' : ''}}
                                    </span>
                                </span>
                            </span>
                            <span *ngIf="editable">
                                <mat-icon matTooltip="eliminar" class="btnAdmin delete-btn">delete</mat-icon>
                            </span>
                        </p>
                    </div>

                    <!-- Cuerpo o región del item del checklist -->
                    <div role="region" class="cdk-accordion-content-body"
                        [style.display]="accordionItem.expanded ? '' : 'none'" [attr.id]="'accordion-body-' + index"
                        [attr.aria-labelledby]="'accordion-header-' + index">

                        <!-- Contenido del item del checklist-->
                        <!-- Mensaje estático -->
                        <p>Responsable: {{ item.responsable }}</p>
                        <p>Se ha iniciado el: {{ item.inicioEstimado | date:'dd/MM/yyyy' }}</p>

                        <p style="color: #f44336" *ngIf="item.completo && item.finReal">
                            Se ha finalizado el: {{ item.finReal | date:'dd/MM/yyyy' }}
                        </p>

                        <!-- Mensaje según ítem finalizado -->
                        <ng-container *ngIf="!item.completo">
                            <p>Es estima finalizar el: {{ item.finEstimado | date:'dd/MM/yyyy' }}</p>
                        </ng-container>

                        <ng-container>
                            <p *ngIf="item.completo && !item.finReal" style="color: #f44336">
                                Se marcó como finalizado
                            </p>
                        </ng-container>


                        <mat-divider style="margin: 0.5rem 0;"></mat-divider>

                        <!-- Datos editables -->
                        <form>

                            <fieldset>
                                <mat-chip-option [selected]="incluyeImpuesto" style="height: 50%;" color="warn" (click)="updateCheckTasa()">
                                    <span>{{ incluyeImpuesto? 'Establecer impuestos/tasas' : 'Editar impuestos/tasas'}}</span>
                                </mat-chip-option>
                            </fieldset>

                            <div class="row" style="display: flex; justify-content:flex-start; align-items: flex-start;">
                                <div class="col-md-4">
                                    <fieldset class="form-group">
                                        <label for="valorTasa" style="margin-right: 0.5rem;">Valor de impuestos/tasas</label>
                                        <div style="display: flex; align-items: center;">
                                            <span style="margin-right: 0.5rem;">$</span>
                                            <input type="number" id="valorTasa" name="valorTasa"
                                                style="width: calc(100% - 0.5rem);" [(ngModel)]="item.tasaValor"
                                                [disabled]="!incluyeImpuesto" (change)="getChange(index+1, item)">
                                        </div>
                                    </fieldset>
                                </div>

                                <div class="col-md-3">
                                    <fieldset class="form-group">
                                        <label for="hojas">Cantidad de hojas </label>
                                        <input type="number" id="hojas" name="hojas" style="width: 100%;"
                                            [(ngModel)]="item.tasaCantidadHojas" [disabled]="!incluyeImpuesto" (change)="getChange(index+2, item)">
                                    </fieldset>
                                </div>
                            </div>

                            <fieldset class="form-group">
                                <label for="urlComprobante">URL Comprobante:</label>
                                <input type="url" name="urlComprobante" id="urlComprobante"
                                    placeholder="https://repo-gg.com" pattern="https://.*" style="width: 100%;"
                                    [(ngModel)]="item.urlComprobanteTasa" [disabled]="!incluyeImpuesto" (change)="getChange(index+3, item)"/>
                            </fieldset>

                            <fieldset>
                                <mat-chip-option [selected]="item.notificado" style="height: 50%;" color="warn"
                                    (click)="updateNotificado(item); getChange(index+4, item)">
                                    <span>{{ item.notificado? 'Se ha establecido notificado' : 'Establecer como notificado'}}</span>
                                </mat-chip-option>
                            </fieldset>
                        </form>

                        <mat-divider style="margin: 0.5rem 0;"></mat-divider>

                    </div>
                </cdk-accordion-item>
                
            </cdk-accordion>

            <!-- Botones del checklist -->
            <div id="checklist-footer" class="modal-footer">
                <button mat-raised-button color="primary" (click)="openAddItemComponent()">
                    <span matTooltip="Agregar al checklist">+ Nuevo Ítem</span>
                </button>
                <button mat-raised-button color="accent" [disabled]="!modified" 
                [mat-dialog-close]="true" type="button" (click)="managElement()">
                    <span>Guardar</span>
                </button>
            </div>

        </div>

    </div>

</div>